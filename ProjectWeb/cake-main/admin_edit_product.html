<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sửa Sản Phẩm</title>

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
  <link rel="stylesheet" href="css/style.css" type="text/css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    body {
      background: url('img/hero/hero-1.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Montserrat', sans-serif;
      color: #222;
    }

    h2 {
      font-weight: 700;
      margin-bottom: 30px;
      color: #222;
    }

    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      padding: 25px;
      background-color: rgba(255, 255, 255, 0.95);
    }

    .table th {
      background-color: #f1f3f9;
    }

    .header__top__left ul li.has-dropdown {
      position: relative;
      cursor: pointer;
    }

    .header__top__left ul li .dropdown {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 100;
      background-color: #333;
      border: 1px solid #555;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      min-width: 200px;
      padding: 5px 0;
      list-style: none;
    }

    .header__top__left ul li.has-dropdown:hover>.dropdown {
      display: block;
    }

    .header__top__left ul li .dropdown li a {
      display: block;
      padding: 10px 15px;
      text-decoration: none;
      color: white;
      font-size: 16px;
      white-space: nowrap;
    }

    .header__top__left ul li .dropdown li a:hover {
      background-color: #555;
      color: #ffcc00;
    }

    #notification-area {
      padding: 0 25px;
      margin-top: 20px;
    }

    /* --- Fix input file --- */
    #loaiAnh {
      display: none;
    }

    .card h5 {
  color: #222 !important; /* MÀU ĐEN (Dùng !important để đảm bảo ghi đè được style nhúng) */
}
/* Căn giữa toàn bộ menu chính */
.header__menu ul {
    display: flex;
    justify-content: center; /* căn giữa menu */
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0;
}

/* Mỗi mục trong menu chính */
.header__menu ul li {
    position: relative;
}

/* Dropdown menu (đen, chữ trắng, tự giãn kích thước) */
.header__menu ul li .dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.95);
    border: 1px solid #444;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    z-index: 100;
    padding: 5px 0;

    /* Cho phép chữ xuống dòng, mở rộng nếu cần */
    white-space: normal; /* cho phép xuống dòng */
    width: auto;         /* tự mở rộng theo nội dung */
    min-width: 230px;    /* kích thước tối thiểu */
    max-width: 300px;    /* tránh quá rộng */
    word-wrap: break-word; /* ngắt dòng nếu chữ dài liền */
}

/* Hiện dropdown khi hover */
.header__menu ul li:hover > .dropdown {
    display: block;
}

/* Các item trong dropdown */
.header__menu ul li .dropdown li {
    display: block;
}

/* Liên kết trong dropdown */
.header__menu ul li .dropdown li a {
    display: block;
    padding: 10px 18px;
    color: #fff;
    text-decoration: none;
    font-size: 15px;
    font-weight: 500;
    transition: background 0.2s, color 0.2s;
    line-height: 1.4; /* giúp dòng chữ cân đối khi xuống dòng */
}

/* Hover đẹp */
.header__menu ul li .dropdown li a:hover {
    background-color: #333;
    color: #ffcc00;
}

/* Hiệu ứng trượt mở */
.header__menu ul li .dropdown {
    opacity: 0;
    visibility: hidden;
    transform: translate(-50%, 10px);
    transition: all 0.25s ease;
}
.header__menu ul li:hover > .dropdown {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, 0);
}

    
    
  </style>
</head>

<body>
  <div id="preloder">
    <div class="loader"></div>
  </div>

  <header class="header">
    <div class="header__top">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="header__top__inner">
              <div class="header__top__left">
                <ul>
                  <li class="has-dropdown">
                    Xin chào <strong>Admin</strong>
                    <span class="arrow_carrot-down"></span>
                    <ul class="dropdown">
                      <li><a href="./admin_login.html">Log out</a></li>
                    </ul>
                  </li>
                </ul>
              </div>
              <div class="header__logo">
                <a href="./#.html"><img src="img/logo.png" alt=""></a>
              </div>
            </div>
          </div>
        </div>
        <div class="canvas__open"><i class="fa fa-bars"></i></div>
      </div>
    </div>
    <div class="container">
      <nav class="header__menu mobile-menu">
        <ul>
          <li><a href="./admin_home.html">Home</a></li>
          <li><a href="./admin_product.html">Quản Lý Đơn Hàng</a></li>
          <li><a href="./admin_member.html">Quản Lý Khách Hàng</a></li>
          <li class="active"><a href="#">Quản Lý Kho</a>
            <ul class="dropdown">
              <li><a href="./admin_category.html">Quản Lý Danh Mục Sản Phẩm</a></li>
              <li><a href="./admin_import.html">Quản Lý Nhập Sản Phẩm</a></li>
              <li><a href="./admin_selling.html">Quản Lý Giá Bán</a></li>
              <li><a href="./admin_quantity.html">Quản Lý Số Lượng Tồn</a></li>
              <li><a href="./admin_type.html">Quản Lý Loại Sản Phẩm</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="container py-5">

    <h2 class="text-center" style="font-weight: 700; font-size: 2.5rem;">Chỉnh sửa sản phẩm</h2>

    <div class="card" style="max-width: 550px; margin: 0 auto; background-color: #f8f9fa;">

      <h5 class="text-center mb-4" style=" font-weight: 700; font-size: 1.5rem;">Thông tin sản phẩm</h5>

      <div id="notification-area" style="padding: 0; margin-top: 0; margin-bottom: 15px;"></div>

      <div class="mb-3 text-center">
        <img id="editImagePreview" src="https://via.placeholder.com/150" alt="Hình ảnh sản phẩm"
          style="width: 150px; height: 150px; object-fit: cover; border-radius: 10px; border: 1px solid #ddd;">
      </div>

      <form id="editForm">
        <div class="mb-3">
    <label for="loaiAnh" class="form-label fw-bold">Ảnh</label>
    
    <div class="input-group">
        
        <label class="input-group-text custom-file-button" for="loaiAnh" style="background-color: #6c757d; color: white; border-color: #6c757d; cursor: pointer;">
            <i class="fa-solid fa-cloud-arrow-up me-2"></i>Chọn tệp
        </label>
        
        <span class="form-control file-name-display" style="background-color: #e9ecef; border-left: none;">
            Không có tệp nào được chọn
        </span>
        
        <input type="file" id="loaiAnh" name="loaiAnh" accept="image/*" style="opacity: 0; position: absolute; z-index: -1; width: 1px; height: 1px;">
    </div>
</div>

        <div class="mb-3">
          <label for="tenDM" class="form-label fw-bold">Tên sản phẩm</label>
          <input type="text" class="form-control" id="tenDM" name="tenDM" placeholder="Loại để phòng">
        </div>

        <div class="mb-3">
          <label for="moTa" class="form-label fw-bold">Mô tả sản phẩm</label>
          <textarea class="form-control" id="moTa" name="moTa" rows="4"
            placeholder="Tạo nên một không gian tươi mát"></textarea>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <button type="button" class="btn btn-warning" id="cancelButton" style="font-weight: 600;">Quay lại</button>
          <button type="submit" class="btn btn-dark" id="saveButton" style="font-weight: 600;">Lưu thay đổi</button>
        </div>
      </form>
    </div>
  </div>

  <script src="js/jquery-3.3.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/jquery.nice-select.min.js"></script> 
<script src="js/main.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const editForm = document.getElementById('editForm');
        const cancelButton = document.getElementById('cancelButton');
        const saveButton = document.getElementById('saveButton');
        const notificationArea = document.getElementById('notification-area');
        const imagePreview = document.getElementById('editImagePreview'); // Ảnh preview
        const loaiAnhInput = document.getElementById('loaiAnh'); // Input file
        const fileNameDisplay = document.querySelector('.file-name-display'); // Tên file hiển thị
        
        const mainPageURL = './admin_category.html'; 

        // === TẠO DỮ LIỆU GIẢ (MOCK DATA) ===
        const mockProductData = {
            "C001": { ten: "Dozen Cupcakes", hinh: "img/shop/product-1.jpg", moTa: "Bộ 12 chiếc cupcake đa dạng hương vị, mềm mịn và ngọt ngào.", vi: "Hỗn hợp" },
            "C002": { ten: "Gluten Free Mini Dozen", hinh: "img/shop/product-3.jpg", moTa: "12 chiếc mini cupcake không gluten, thơm ngon tự nhiên.", vi: "Dâu" },
            "C003": { ten: "Cookie Dough", hinh: "img/shop/product-4.jpg", moTa: "Cupcake hương cookie dough béo ngậy, phủ kem vani mịn.", vi: "Hỗn hợp" },
            "C011": { ten: "Vanilla Salted Caramel", hinh: "img/shop/product-5.jpg", moTa: "Bánh vani mềm mịn hòa quyện cùng lớp caramel muối mặn ngọt.", vi: "Hỗn hợp" },
            "C012": { ten: "German Chocolate", hinh: "img/shop/product-6.jpg", moTa: "Cupcake chocolate đậm đà kết hợp nhân dừa và hạt óc chó.", vi: "Socola" }
        };

        // 1. Tải dữ liệu khi trang được mở
        function loadProductData() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            if (!productId) {
                showError("Không tìm thấy ID sản phẩm.");
                return;
            }
            
            const product = mockProductData[productId];
            
            if (!product) {
                showError(`Không tìm thấy dữ liệu cho sản phẩm có ID: ${productId}`);
                return;
            }
            
            // Điền dữ liệu vào form
          //  editForm.querySelector('[name="maDM"]').value = productId;
            editForm.querySelector('[name="tenDM"]').value = product.ten;
           // editForm.querySelector('[name="viBanh"]').value = product.vi;
            editForm.querySelector('[name="moTa"]').value = product.moTa;
            
            // === TẢI ẢNH GỐC VÀ TÊN FILE KHI LOAD TRANG ===
            imagePreview.src = product.hinh; 
            if (fileNameDisplay) {
                // Hiển thị tên file gốc (ví dụ: product-1.jpg)
                fileNameDisplay.textContent = product.hinh.split('/').pop(); 
            }
        }
        
        // === LOGIC XỬ LÝ KHI CHỌN FILE MỚI ===
        if (loaiAnhInput && imagePreview && fileNameDisplay) {
            loaiAnhInput.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    // 1. Hiển thị tên file mới
                    fileNameDisplay.textContent = file.name;
                    
                    // 2. Hiển thị ảnh preview ngay lập tức
                    const reader = new FileReader();
                    reader.onload = e => imagePreview.src = e.target.result;
                    reader.readAsDataURL(file);
                } else {
                    // Nếu người dùng nhấn hủy/clear, tải lại dữ liệu gốc
                    loadProductData(); 
                }
            });
        }
        // === KẾT THÚC LOGIC FILE MỚI ===

        // 2. Hàm hiển thị lỗi
        function showError(message) {
               notificationArea.innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        <strong>Lỗi!</strong> ${message}
                    </div>
                `;
            saveButton.disabled = true; 
        }

        // 3. Xử lý nút Hủy
        cancelButton.addEventListener('click', function() {
            window.location.href = mainPageURL;
        });

        // 4. Xử lý nút Lưu thay đổi (khi submit form)
        editForm.addEventListener('submit', function(e) {
            e.preventDefault(); 
            
            const formData = new FormData(editForm);
            const tenDM = formData.get('tenDM') || "Sản phẩm";

            notificationArea.innerHTML = `
                <div class="alert alert-success d-flex align-items-center" role="alert">
                    <i class="fa-solid fa-check-circle me-2"></i>
                    <div>
                        <strong>Thành công!</strong> Bạn đã cập nhật sản phẩm "${tenDM}" thành công.
                    </div>
                </div>
            `;
            
            saveButton.disabled = true;
            cancelButton.disabled = true;

            setTimeout(function() {
                window.location.href = mainPageURL;
            }, 2000); 
        });
        
        // 5. Chạy hàm tải dữ liệu
        loadProductData();
    });
</script>
  
</body>

</html>
